function M = mass(t,x)

%-------------------------------------------------------------------------%
% All solvers solve systems of equations in the form 
% y' = f(t,y) or problems that involve a mass matrix, 
% M(t,y)y' = f(t,y). The ode23s solver can solve only 
% equations with constant mass matrices. ode15s and 
% ode23t can solve problems with a mass matrix that is 
% singular, i.e., differential-algebraic equations (DAEs).
%-------------------------------------------------------------------------%

%-------------------------------------------------------------------------%
% All solvers solve systems of equations in the form 
% y' = f(t,y) or problems that involve a mass matrix, 
% M(t,y)y' = f(t,y). The ode23s solver can solve only 
% equations with constant mass matrices. ode15s and 
% ode23t can solve problems with a mass matrix that is 
% singular, i.e., differential-algebraic equations (DAEs).
%-------------------------------------------------------------------------%

global mb Ib mF1 IF1 mF2 IF2 mF3 IF3 mH1 IH1 mH2 IH2 mH3 IH3 mT mTR ITR
global db lb dbT dF1 dF2 dF3 dH1 dH2 dH3 dT dTR
global lF1 lF2 lF3 lH1 lH2 lH3

%-------------------------------------------------------------------------%
% x(1) = xb 
% x(2) = xb' 
% x(3) = yb
% x(4) = yb'
% x(5) = thb
% x(6) = thb'
% x(7) = thFR1
% x(8) = thFR1'
% x(9) = thFR2
% x(10) = thFR2'
% x(11) = thFR3
% x(12) = thFR3'
% x(13) = thHR1
% x(14) = thHR1'
% x(15) = thHR2
% x(16) = thHR2'
% x(17) = thHR3
% x(18) = thHR3'
% x(19) = thFL1
% x(20) = thFL1'
% x(21) = thFL2
% x(22) = thFL2'
% x(23) = thFL3
% x(24) = thFL3'
% x(25) = thHL1
% x(26) = thHL1'
% x(27) = thHL2
% x(28) = thHL2'
% x(29) = thHL3
% x(30) = thHL3'
% x(31) = thT
% x(32) = thT'
%-------------------------------------------------------------------------%

xb = x(1);
xbdot = x(2); 
yb = x(3);
ybdot = x(4);
thb = x(5);
thbdot = x(6);
thFR1 = x(7);
thFR1dot = x(8);
thFR2 = x(9);
thFR2dot = x(10);
thFR3 = x(11);
thFR3dot = x(12);
thHR1 = x(13);
thHR1dot = x(14);
thHR2 = x(15);
thHR2dot = x(16);
thHR3 = x(17);
thHR3dot = x(18);
thFL1 = x(19);
thFL1dot = x(20);
thFL2 = x(21);
thFL2dot = x(22);
thFL3 = x(23);
thFL3dot = x(24);
thHL1 = x(25);
thHL1dot = x(26);
thHL2 = x(27);
thHL2dot = x(28);
thHL3 = x(29);
thHL3dot = x(30);
thT = x(31);
thTdot = x(32);

%-------------------------------------------------------------------------%
% Mass matrix
%-------------------------------------------------------------------------%
M = zeros(32,32);

%-------------------------------------------------------------------------%
% From Mathematica we get
%-------------------------------------------------------------------------%
M(2,2)=mb+2.*mF1+2.*mF2+2.*mF3+2.*mH1+2.*mH2+2.*mH3+mT+mTR;
M(2,4)=0;
M(2,6)=(2.*lb.*(mH1+mH2+mH3)+(-2).*db.*(mF1+mF2+mF3+mH1+mH2+mH3)+ ...
  dbT.*(mT+mTR)).*sin(thb);
M(2,8)=(dF1.*mF1+lF1.*(mF2+mF3)).*cos(thFR1);
M(2,10)=(dF2.*mF2+lF2.*mF3).*cos(thFR2);
M(2,12)=dF3.*mF3.*cos(thFR3);
M(2,14)=(dH1.*mH1+lH1.*(mH2+mH3)).*cos(thHR1);
M(2,16)=(dH2.*mH2+lH2.*mH3).*cos(thHR2);
M(2,18)=dH3.*mH3.*cos(thHR3);
M(2,20)=(dF1.*mF1+lF1.*(mF2+mF3)).*cos(thFL1);
M(2,22)=(dF2.*mF2+lF2.*mF3).*cos(thFL2);
M(2,24)=dF3.*mF3.*cos(thFL3);
M(2,26)=(dH1.*mH1+lH1.*(mH2+mH3)).*cos(thHL1);
M(2,28)=(dH2.*mH2+lH2.*mH3).*cos(thHL2);
M(2,30)=dH3.*mH3.*cos(thHL3);
M(2,32)=(dT.*mT+dTR.*mTR).*cos(thT);

M(4,4)=mb+2.*mF1+2.*mF2+2.*mF3+2.*mH1+2.*mH2+2.*mH3+mT+mTR;
M(4,6)=((-2).*lb.*(mH1+mH2+mH3)+2.*db.*(mF1+mF2+mF3+mH1+mH2+mH3)+( ...
  -1).*dbT.*mT).*cos(thb)+dbT.*mTR.*sin(thb);
M(4,8)=(dF1.*mF1+lF1.*(mF2+mF3)).*sin(thFR1);
M(4,10)=(dF2.*mF2+lF2.*mF3).*sin(thFR2);
M(4,12)=dF3.*mF3.*sin(thFR3);
M(4,14)=(dH1.*mH1+lH1.*(mH2+mH3)).*sin(thHR1);
M(4,16)=(dH2.*mH2+lH2.*mH3).*sin(thHR2);
M(4,18)=dH3.*mH3.*sin(thHR3);
M(4,20)=(dF1.*mF1+lF1.*(mF2+mF3)).*sin(thFL1);
M(4,22)=(dF2.*mF2+lF2.*mF3).*sin(thFL2);
M(4,24)=dF3.*mF3.*sin(thFL3);
M(4,26)=(dH1.*mH1+lH1.*(mH2+mH3)).*sin(thHL1);
M(4,28)=(dH2.*mH2+lH2.*mH3).*sin(thHL2);
M(4,30)=dH3.*mH3.*sin(thHL3);
M(4,32)=(dT.*mT+dTR.*mTR).*sin(thT);

M(6,6)=Ib+(-4).*db.*lb.*(mH1+mH2+mH3)+2.*lb.^2.*(mH1+mH2+mH3)+2.* ...
  db.^2.*(mF1+mF2+mF3+mH1+mH2+mH3)+dbT.^2.*(mT+mTR)+(-1).* ...
  dbT.^2.*mTR.*cos(2.*thb);
M(6,8)=(-1).*db.*(dF1.*mF1+lF1.*(mF2+mF3)).*sin(thb+(-1).*thFR1);
M(6,10)=(-1).*db.*(dF2.*mF2+lF2.*mF3).*sin(thb+(-1).*thFR2);
M(6,12)=(-1).*db.*dF3.*mF3.*sin(thb+(-1).*thFR3);
M(6,14)=(-1).*(db+(-1).*lb).*(dH1.*mH1+lH1.*(mH2+mH3)).*sin(thb+(-1) ...
  .*thHR1);
M(6,16)=(-1).*(db+(-1).*lb).*(dH2.*mH2+lH2.*mH3).*sin(thb+(-1).* ...
  thHR2);
M(6,18)=dH3.*((-1).*db+lb).*mH3.*sin(thb+(-1).*thHR3);
M(6,20)=(-1).*db.*(dF1.*mF1+lF1.*(mF2+mF3)).*sin(thb+(-1).*thFL1);
M(6,22)=(-1).*db.*(dF2.*mF2+lF2.*mF3).*sin(thb+(-1).*thFL2);
M(6,24)=(-1).*db.*dF3.*mF3.*sin(thb+(-1).*thFL3);
M(6,26)=(-1).*(db+(-1).*lb).*(dH1.*mH1+lH1.*(mH2+mH3)).*sin(thb+(-1) ...
  .*thHL1);
M(6,28)=(-1).*(db+(-1).*lb).*(dH2.*mH2+lH2.*mH3).*sin(thb+(-1).* ...
  thHL2);
M(6,30)=dH3.*((-1).*db+lb).*mH3.*sin(thb+(-1).*thHL3);
M(6,32)=dbT.*((dT.*mT+dTR.*mTR).*cos(thT).*sin(thb)+((-1).*dT.*mT.* ...
  cos(thb)+dTR.*mTR.*sin(thb)).*sin(thT));

M(8,8)=IF1+dF1.^2.*mF1+lF1.^2.*(mF2+mF3);
M(8,10)=lF1.*(dF2.*mF2+lF2.*mF3).*cos(thFR1+(-1).*thFR2);
M(8,12)=dF3.*lF1.*mF3.*cos(thFR1+(-1).*thFR3);
M(8,14)=0;
M(8,16)=0;
M(8,18)=0;
M(8,20)=0;
M(8,22)=0;
M(8,24)=0;
M(8,26)=0;
M(8,28)=0;
M(8,30)=0;
M(8,32)=0;

M(10,10)=IF2+dF2.^2.*mF2+lF2.^2.*mF3;
M(10,12)=dF3.*lF2.*mF3.*cos(thFR2+(-1).*thFR3);
M(10,14)=0;
M(10,16)=0;
M(10,18)=0;
M(10,20)=0;
M(10,22)=0;
M(10,24)=0;
M(10,26)=0;
M(10,28)=0;
M(10,30)=0;
M(10,32)=0;

M(12,12)=IF3+dF3.^2.*mF3;
M(12,14)=0;
M(12,16)=0;
M(12,18)=0;
M(12,20)=0;
M(12,22)=0;
M(12,24)=0;
M(12,26)=0;
M(12,28)=0;
M(12,30)=0;
M(12,32)=0;

M(14,14)=IH1+dH1.^2.*mH1+lH1.^2.*(mH2+mH3);
M(14,16)=lH1.*(dH2.*mH2+lH2.*mH3).*cos(thHR1+(-1).*thHR2);
M(14,18)=dH3.*lH1.*mH3.*cos(thHR1+(-1).*thHR3);
M(14,20)=0;
M(14,22)=0;
M(14,24)=0;
M(14,26)=0;
M(14,28)=0;
M(14,30)=0;
M(14,32)=0;

M(16,16)=IH2+dH2.^2.*mH2+lH2.^2.*mH3;
M(16,18)=dH3.*lH2.*mH3.*cos(thHR2+(-1).*thHR3);
M(16,20)=0;
M(16,22)=0;
M(16,24)=0;
M(16,26)=0;
M(16,28)=0;
M(16,30)=0;
M(16,32)=0;

M(18,18)=IH3+dH3.^2.*mH3;
M(18,20)=0;
M(18,22)=0;
M(18,24)=0;
M(18,26)=0;
M(18,28)=0;
M(18,30)=0;
M(18,32)=0;

M(20,20)=IF1+dF1.^2.*mF1+lF1.^2.*(mF2+mF3);
M(20,22)=lF1.*(dF2.*mF2+lF2.*mF3).*cos(thFL1+(-1).*thFL2);
M(20,24)=dF3.*lF1.*mF3.*cos(thFL1+(-1).*thFL3);
M(20,26)=0;
M(20,28)=0;
M(20,30)=0;
M(20,32)=0;

M(22,22)=IF2+dF2.^2.*mF2+lF2.^2.*mF3;
M(22,24)=dF3.*lF2.*mF3.*cos(thFL2+(-1).*thFL3);
M(22,26)=0;
M(22,28)=0;
M(22,30)=0;
M(22,32)=0;

M(24,24)=IF3+dF3.^2.*mF3;
M(24,26)=0;
M(24,28)=0;
M(24,30)=0;
M(24,32)=0;

M(26,26)=IH1+dH1.^2.*mH1+lH1.^2.*(mH2+mH3);
M(26,28)=lH1.*(dH2.*mH2+lH2.*mH3).*cos(thHL1+(-1).*thHL2);
M(26,30)=dH3.*lH1.*mH3.*cos(thHL1+(-1).*thHL3);
M(26,32)=0;

M(28,28)=IH2+dH2.^2.*mH2+lH2.^2.*mH3;
M(28,30)=dH3.*lH2.*mH3.*cos(thHL2+(-1).*thHL3);
M(28,32)=0;

M(30,30)=IH3+dH3.^2.*mH3;
M(30,32)=0;

M(32,32)=ITR+dT.^2.*mT+dTR.^2.*mTR;

%-------------------------------------------------------------------------%
% We add the symmetric elements
%-------------------------------------------------------------------------%
M(4,2)=M(2,4);
M(6,2)=M(2,6);
M(8,2)=M(2,8);
M(10,2)=M(2,10);
M(12,2)=M(2,12);
M(14,2)=M(2,14);
M(16,2)=M(2,16);
M(18,2)=M(2,18);
M(20,2)=M(2,20);
M(22,2)=M(2,22);
M(24,2)=M(2,24);
M(26,2)=M(2,26);
M(28,2)=M(2,28);
M(30,2)=M(2,30);
M(32,2)=M(2,32);

M(6,4)=M(4,6);
M(8,4)=M(4,8);
M(10,4)=M(4,10);
M(12,4)=M(4,12);
M(14,4)=M(4,14);
M(16,4)=M(4,16);
M(18,4)=M(4,18);
M(20,4)=M(4,20);
M(22,4)=M(4,22);
M(24,4)=M(4,24);
M(26,4)=M(4,26);
M(28,4)=M(4,28);
M(30,4)=M(4,30);
M(32,4)=M(4,32);

M(8,6)=M(6,8);
M(10,6)=M(6,10);
M(12,6)=M(6,12);
M(14,6)=M(6,14);
M(16,6)=M(6,16);
M(18,6)=M(6,18);
M(20,6)=M(6,20);
M(22,6)=M(6,22);
M(24,6)=M(6,24);
M(26,6)=M(6,26);
M(28,6)=M(6,28);
M(30,6)=M(6,30);
M(32,6)=M(6,32);

M(10,8)=M(8,10);
M(12,8)=M(8,12);
M(14,8)=M(8,14);
M(16,8)=M(8,16);
M(18,8)=M(8,18);
M(20,8)=M(8,20);
M(22,8)=M(8,22);
M(24,8)=M(8,24);
M(26,8)=M(8,26);
M(28,8)=M(8,28);
M(30,8)=M(8,30);
M(32,8)=M(8,32);

M(12,10)=M(10,12);
M(14,10)=M(10,14);
M(16,10)=M(10,16);
M(18,10)=M(10,18);
M(20,10)=M(10,20);
M(22,10)=M(10,22);
M(24,10)=M(10,24);
M(26,10)=M(10,26);
M(28,10)=M(10,28);
M(30,10)=M(10,30);
M(32,10)=M(10,32);

M(14,12)=M(12,14);
M(16,12)=M(12,16);
M(18,12)=M(12,18);
M(20,12)=M(12,20);
M(22,12)=M(12,22);
M(24,12)=M(12,24);
M(26,12)=M(12,26);
M(28,12)=M(12,28);
M(30,12)=M(12,30);
M(32,12)=M(12,32);

M(16,14)=M(14,16);
M(18,14)=M(14,18);
M(20,14)=M(14,20);
M(22,14)=M(14,22);
M(24,14)=M(14,24);
M(26,14)=M(14,26);
M(28,14)=M(14,28);
M(30,14)=M(14,30);
M(32,14)=M(14,32);

M(18,16)=M(16,18);
M(20,16)=M(16,20);
M(22,16)=M(16,22);
M(24,16)=M(16,24);
M(26,16)=M(16,26);
M(28,16)=M(16,28);
M(30,16)=M(16,30);
M(32,16)=M(16,32);

M(20,18)=M(18,20);
M(22,18)=M(18,22);
M(24,18)=M(18,24);
M(26,18)=M(18,26);
M(28,18)=M(18,28);
M(30,18)=M(18,30);
M(32,18)=M(18,32);

M(22,20)=M(20,22);
M(24,20)=M(20,24);
M(26,20)=M(20,26);
M(28,20)=M(20,28);
M(30,20)=M(20,30);
M(32,20)=M(20,32);

M(24,22)=M(22,24);
M(26,22)=M(22,26);
M(28,22)=M(22,28);
M(30,22)=M(22,30);
M(32,22)=M(22,32);

M(26,24)=M(24,26);
M(28,24)=M(24,28);
M(30,24)=M(24,30);
M(32,24)=M(24,32);

M(28,26)=M(26,28);
M(30,26)=M(26,30);
M(32,26)=M(26,32);

M(30,28)=M(28,30);
M(32,28)=M(28,32);

M(32,30)=M(30,32);

%-------------------------------------------------------------------------%
% We add aces for diagonal odd elements
%-------------------------------------------------------------------------%
M(1,1) = 1;
M(3,3) = 1;
M(5,5) = 1;
M(7,7) = 1;
M(9,9) = 1;
M(11,11) = 1;
M(13,13) = 1;
M(15,15) = 1;
M(17,17) = 1;
M(19,19) = 1;
M(21,21) = 1;
M(23,23) = 1;
M(25,25) = 1;
M(27,27) = 1;
M(29,29) = 1;
M(31,31) = 1;


